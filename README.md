# Weather MCP Server

MCP (Model Context Protocol) —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ —á–µ—Ä–µ–∑ OpenWeatherMap API.

## –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª MCP –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è:
- –¢–µ–∫—É—â–µ–π –ø–æ–≥–æ–¥—ã –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≥–æ—Ä–æ–¥–∞
- 5-–¥–Ω–µ–≤–Ω–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞ –ø–æ–≥–æ–¥—ã
- –¢–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –¥–∞—Ç—ã –∏ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –≥–æ—Ä–æ–¥–∞

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è MCP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (JSON-RPC 2.0)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenWeatherMap API
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è (metric, imperial, standard)
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è —Å Docker
- Health check endpoints
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Kotlin
- Ktor (Web Framework)
- kotlinx.serialization (JSON —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è)
- Docker & Docker Compose
- OpenWeatherMap API (–ø–æ–≥–æ–¥–∞ –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
- WorldTimeAPI (–≤—Ä–µ–º—è –∏ —á–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞)

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. JDK 17 –∏–ª–∏ –≤—ã—à–µ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
2. Docker –∏ Docker Compose (–¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–Ω–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è)
3. API –∫–ª—é—á –æ—Ç OpenWeatherMap (–ø–æ–ª—É—á–∏—Ç—å –Ω–∞ https://openweathermap.org/api)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:
   ```bash
   cp .env.example .env
   ```

3. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à API –∫–ª—é—á –≤ `.env`:
   ```
   OPENWEATHER_API_KEY=–≤–∞—à_api_–∫–ª—é—á
   ```

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
   ```bash
   export OPENWEATHER_API_KEY=–≤–∞—à_api_–∫–ª—é—á
   ./gradlew run
   ```

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:
   ```bash
   cp .env.example .env
   ```

2. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à API –∫–ª—é—á –≤ `.env`

3. –°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:
   ```bash
   docker-compose up -d
   ```

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:
   ```bash
   docker-compose ps
   ```

5. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
   ```bash
   docker-compose logs -f
   ```

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ VPS

1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ VPS:
   ```bash
   ssh user@your-vps-ip
   ```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker –∏ Docker Compose (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)

3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ VPS:
   ```bash
   git clone your-repo-url
   cd mcp-power-server
   ```

4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```bash
   cp .env.example .env
   nano .env  # –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à API –∫–ª—é—á
   ```

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:
   ```bash
   docker-compose up -d
   ```

6. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   ```bash
   # Docker Compose –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (restart: unless-stopped)
   ```

## API Endpoints

### Health Check
```bash
GET /health
```

### MCP Endpoint
```bash
POST /mcp
Content-Type: application/json
```

## MCP Tools

### 1. get_current_weather

–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –ø–æ–≥–æ–¥—É –¥–ª—è –≥–æ—Ä–æ–¥–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `city` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "London", "Moscow")
- `units` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π): –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è - "metric" (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), "imperial", "standard"

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "jsonrpc": "2.0",
  "id": "1",
  "method": "tools/call",
  "params": {
    "name": "get_current_weather",
    "arguments": {
      "city": "London",
      "units": "metric"
    }
  }
}
```

### 2. get_weather_forecast

–ü–æ–ª—É—á–∏—Ç—å 5-–¥–Ω–µ–≤–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `city` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
- `units` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π): –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "jsonrpc": "2.0",
  "id": "2",
  "method": "tools/call",
  "params": {
    "name": "get_weather_forecast",
    "arguments": {
      "city": "Moscow",
      "units": "metric"
    }
  }
}
```

### 3. get_city_time

–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è, –¥–∞—Ç—É –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ –¥–ª—è –≥–æ—Ä–æ–¥–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `city` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π): –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "jsonrpc": "2.0",
  "id": "3",
  "method": "tools/call",
  "params": {
    "name": "get_city_time",
    "arguments": {
      "city": "Tokyo"
    }
  }
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```
üïê Time in Tokyo, JP

Current time: 15:30:45
Current date: 2024-12-17
Day of week: Tuesday

Timezone: Asia/Tokyo
UTC offset: +09:00
DST active: No

Unix timestamp: 1702814445
```

## MCP –ú–µ—Ç–æ–¥—ã

- `initialize` - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è MCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- `tools/list` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
- `tools/call` - –í—ã–∑–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–µ—Ä–∞
curl http://localhost:8080/health

# –¢–µ—Å—Ç MCP initialize
curl -X POST http://localhost:8080/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": "1",
    "method": "initialize"
  }'

# –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã
curl -X POST http://localhost:8080/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": "2",
    "method": "tools/call",
    "params": {
      "name": "get_current_weather",
      "arguments": {
        "city": "London",
        "units": "metric"
      }
    }
  }'

# –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≥–æ—Ä–æ–¥–∞
curl -X POST http://localhost:8080/mcp \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "id": "3",
    "method": "tools/call",
    "params": {
      "name": "get_city_time",
      "arguments": {
        "city": "Tokyo"
      }
    }
  }'
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
./gradlew build
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
./gradlew test
```

### –°–±–æ—Ä–∫–∞ Fat JAR
```bash
./gradlew buildFatJar
```

### –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞
```bash
docker build -t mcp-weather-server:latest .
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
src/
‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îú‚îÄ‚îÄ kotlin/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ com/bazik/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ mcp/
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ models/      # MCP –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ McpService.kt # MCP –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ weather/
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ models/      # OpenWeatherMap –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ WeatherService.kt # –†–∞–±–æ—Ç–∞ —Å Weather API
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ time/
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ models/      # TimeZone –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ TimeService.kt # –†–∞–±–æ—Ç–∞ —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Application.kt   # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ Routing.kt       # –ú–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ Serialization.kt # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ resources/
‚îÇ       ‚îî‚îÄ‚îÄ application.conf     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

## Troubleshooting

### –û—à–∏–±–∫–∞ "API key is not configured"
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `OPENWEATHER_API_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞.

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
```bash
docker-compose logs
```

### –ü–æ—Ä—Ç 8080 –∑–∞–Ω—è—Ç
–ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç –≤ `docker-compose.yml` –∏–ª–∏ `.env`:
```yaml
ports:
  - "8081:8080"  # –ò—Å–ø–æ–ª—å–∑—É–µ–º 8081 –≤–º–µ—Å—Ç–æ 8080
```

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

